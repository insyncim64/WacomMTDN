<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WintabDN Help: A WintabDN example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>A <a class="el" href="namespace_wintab_d_n.html">WintabDN</a> example </h1>  </div>
</div>
<div class="contents">
<p>The <a class="el" href="namespace_wintab_d_n.html">WintabDN</a> distribution comes with a sample application, FormTestApp, which exercises most of the <a class="el" href="namespace_wintab_d_n.html">WintabDN</a> functionality, as well as demonstrates how to use the API to build a simple scribble application.</p>
<h2><a class="anchor" id="scribbleDemo_sec"></a>
Scribble Demo</h2>
<p>The Scribble demo shows how to set up a context, register for Wintab data packets, provide a handler for Wintab events, and display graphics corresponding to pen X/Y position and pen pressure data.</p>
<p>The following code segment shows the "Scribble" button handler, which opens sets up for pen data capture using the <code><b>InitDataCapture()</b></code> function. </p>
<div class="fragment"><pre class="fragment">    <span class="keyword">private</span> <span class="keywordtype">void</span> scribbleButton_Click(<span class="keywordtype">object</span> sender, EventArgs e)
    {
        ClearDisplay();
        CloseCurrentContext();
        Enable_Scribble(<span class="keyword">true</span>);

        <span class="comment">// Open a context and try to capture pen data;</span>
        <span class="comment">// Do not control system cursor.</span>

        InitDataCapture(m_TABEXTX, m_TABEXTY, <span class="keyword">false</span>);
    }
</pre></div><p><code><b>InitDataCapture()</b></code> makes sure it closes the current Wintab context, opens up a new context with <code><b>OpenTestDigitizerContext()</b></code>, creates a Wintab data object with <code><b>new CWintabData(m_logContext)</b></code>, which uses the context just created, and finally sets up a packet event handler for being notified when pen data comes in. Note that the call to <code><b>InitDataCapture()</b></code> is made with ctrlSysCursor_I = false, because we cannot be controlling the system cursor while scribbling.</p>
<div class="fragment"><pre class="fragment">    <span class="keyword">private</span> <span class="keywordtype">void</span> InitDataCapture(
    <span class="keywordtype">int</span> ctxHeight_I = m_TABEXTX, <span class="keywordtype">int</span> ctxWidth_I = m_TABEXTY, <span class="keywordtype">bool</span> ctrlSysCursor_I = <span class="keyword">true</span>)
    {
        <span class="keywordflow">try</span>
        {
            <span class="comment">// Close context from any previous test.</span>
            CloseCurrentContext();

            m_logContext = OpenTestDigitizerContext(ctxWidth_I, ctxHeight_I,  ctrlSysCursor_I);

            <span class="keywordflow">if</span> (m_logContext == null)
            {
                <span class="keywordflow">return</span>;
            }

            <span class="comment">// Create a data object and set its WT_PACKET handler.</span>
            m_wtData = <span class="keyword">new</span> CWintabData(m_logContext);
            m_wtData.SetWTPacketEventHandler(MyWTPacketEventHandler);
        }
        <span class="keywordflow">catch</span> (Exception ex)
        {
            MessageBox.Show(ex.ToString());
        }
    }
</pre></div><p>When creating the digitizer context, we start with getting the default context using <code><b>CWintabInfo.GetDefaultDigitizingContext(ECTXOptionValues.CXO_MESSAGES)</b></code>, which specifies that we want to receive Wintab messages to be notified of pen data. Since we are not specifying that we want to control the system cursor, the only other thing we have to override is the description of the logical extent of the tablet coordinates. For this example, we specify a logical tablet size of 10000 x 10000. That's pretty much it. We just tell <a class="el" href="namespace_wintab_d_n.html">WintabDN</a> to open this context using <code><b>logContext.Open()</b></code>.</p>
<div class="fragment"><pre class="fragment">    <span class="keyword">private</span> CWintabContext OpenTestDigitizerContext(
        <span class="keywordtype">int</span> width_I = m_TABEXTX, <span class="keywordtype">int</span> height_I = m_TABEXTY, <span class="keywordtype">bool</span> ctrlSysCursor = <span class="keyword">true</span>)
    {
        <span class="keywordtype">bool</span> status = <span class="keyword">false</span>;
        CWintabContext logContext = null;

        <span class="keywordflow">try</span>
        {
            <span class="comment">// Get the default digitizing context.</span>
            <span class="comment">// Default is to receive data events.</span>
            logContext = CWintabInfo.GetDefaultDigitizingContext(<a class="code" href="namespace_wintab_d_n.html#a701e8021b6889039ed562596a2d1bdd2" title="Context option values.">ECTXOptionValues</a>.CXO_MESSAGES);

            <span class="comment">// Set system cursor if caller wants it.</span>
            <span class="keywordflow">if</span> (ctrlSysCursor)
            {
                logContext.Options |= (uint)<a class="code" href="namespace_wintab_d_n.html#a701e8021b6889039ed562596a2d1bdd2" title="Context option values.">ECTXOptionValues</a>.CXO_SYSTEM;
            }

            <span class="keywordflow">if</span> (logContext == null)
            {
                <span class="keywordflow">return</span> null;
            }

            <span class="comment">// Modify the digitizing region.</span>
            logContext.Name = <span class="stringliteral">&quot;WintabDN Event Data Context&quot;</span>;

            <span class="comment">// output in a 10000 x 10000 grid</span>
            logContext.OutOrgX = logContext.OutOrgY = 0;
            logContext.OutExtX = width_I;
            logContext.OutExtY = height_I;


            <span class="comment">// Open the context, which will also tell Wintab to send data packets.</span>
            status = logContext.Open();
        }
        <span class="keywordflow">catch</span> (Exception ex)
        {
            TraceMsg(<span class="stringliteral">&quot;OpenTestDigitizerContext ERROR: &quot;</span> + ex.ToString());
        }

        <span class="keywordflow">return</span> logContext;
    }
</pre></div><p>Finally, we show that the event handler can easily access the pen data using <code><b>m_wtData.GetDataPacket(pktID)</b></code>. The packet contains values for the X/Y position and pen normal pressure. The example also makes use of the packet timestamp, which helps determine whether to draw a line between points or just draw a rectangle at the point. This allows the drawn lines to be less choppy when the user moves the pen quickly.</p>
<div class="fragment"><pre class="fragment">    <span class="keyword">public</span> <span class="keywordtype">void</span> MyWTPacketEventHandler(Object sender_I, MessageReceivedEventArgs eventArgs_I)
    {
        <span class="keywordflow">try</span>
        {
            <span class="keywordflow">if</span> (m_maxPkts == 1)
            {
                uint pktID = (uint)eventArgs_I.Message.WParam;
                WintabPacket pkt = m_wtData.GetDataPacket(pktID);

                <span class="keywordflow">if</span> (pkt.pkContext != 0)
                {
                    m_pkX = pkt.pkX;
                    m_pkY = pkt.pkY;
                    m_pressure = pkt.pkNormalPressure.pkAbsoluteNormalPressure;

                    m_pkTime = pkt.pkTime;

                    <span class="keywordflow">if</span> (m_graphics != null)
                    {
                        <span class="comment">// scribble mode</span>
                        <span class="keywordtype">int</span> clientWidth = scribblePanel.Width;
                        <span class="keywordtype">int</span> clientHeight = scribblePanel.Height;

                        <span class="keywordtype">int</span> X = (int)((<span class="keywordtype">double</span>)(m_pkX * clientWidth) / (<span class="keywordtype">double</span>)m_TABEXTX);
                        <span class="keywordtype">int</span> Y = (int)((<span class="keywordtype">double</span>)clientHeight - 
                            ((double)(m_pkY * clientHeight) / (double)m_TABEXTY));

                        Point tabPoint = <span class="keyword">new</span> Point(X, Y);

                        <span class="keywordflow">if</span> (m_lastPoint.Equals(Point.Empty))
                        {
                            m_lastPoint = tabPoint;
                            m_pkTimeLast = m_pkTime;
                        }

                        m_pen.Width = (float)(m_pressure / 200);
                        <span class="keywordflow">if</span> (m_pressure &gt; 0)
                        {
                            <span class="keywordflow">if</span> (m_pkTime - m_pkTimeLast &lt; 5)
                            {
                                m_graphics.DrawRectangle(m_pen, X, Y, 1, 1);
                            }
                            <span class="keywordflow">else</span>
                            {
                                m_graphics.DrawLine(m_pen, tabPoint, m_lastPoint);
                            }
                        }

                        m_lastPoint = tabPoint;
                        m_pkTimeLast = m_pkTime;
                    }
                }
            }
        }
        <span class="keywordflow">catch</span> (Exception ex)
        {
            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;FAILED to get packet data: &quot;</span> + ex.ToString());
        }
    }
</pre></div><h2><a class="anchor" id="testWTInfo_sec"></a>
Testing CWintabInfo</h2>
<p>The testing in this section is just a demonstration of the various CWintabDN.CWintabInfo properties.</p>
<p>Here is one of the first calls an application might make to determine if Wintab is properly connected on the system: </p>
<div class="fragment"><pre class="fragment">        <span class="keywordtype">bool</span> isWintabAvailable = CWintabInfo.IsWintabAvailable();
</pre></div><p>This is an example of how to find the number of tablet devices connected: </p>
<div class="fragment"><pre class="fragment">        UInt32 numDevices = CWintabInfo.GetNumberOfDevices();
</pre></div><p>Here is an example of how easy it is to get a default digitizing context (which is used in the <a class="el" href="page2.html#scribbleDemo_sec">Scribble Demo</a> example): </p>
<div class="fragment"><pre class="fragment">        CWintabContext context = CWintabInfo.GetDefaultDigitizingContext();
</pre></div><p>You can look through the other tests to see how some of the other global Wintab properties can be accessed.</p>
<p>One of the tests, <code><b>Test_GetDataPackets()</b></code> gives a demonstration of capturing data packets and writing them out to the list. This demo is very similar to the <a class="el" href="page2.html#scribbleDemo_sec">Scribble Demo</a>, so we won't go into much detail here except to note that the call to <code><b>InitDataCapture()</b></code> is made with <code><b>ctrlSysCursor_I</b></code> being true, so that the system cursor can be controlled with the pen. </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Mon Mar 18 2013 08:38:37 for WintabDN Help by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
